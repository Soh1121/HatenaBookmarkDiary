## [SSRF攻撃によるCapital Oneの個人情報流出についてまとめてみた](https://piyolog.hatenadiary.jp/entry/2019/08/06/062154)
### 概要
- 2019年7月29日、米金融大手 Capital Oneは不正アクセスにより1億人を超える個人情報が流出
- WAFの設定ミスに起因して、Server Side Request Forgery（SSRF）攻撃を許したことによる
- 影響範囲
  - 米国 約1億人
  - カナダ 約600万人
- 外部流出した情報
  - クレジットカードへの申し込みを行った消費者、および中小企業に関する情報
  - 2005年～2019年初めまでの間に収集された情報
  - 氏名、住所、郵便番号、電話番号、メールアドレス、生年月日、年収（自己申告）
  - カードのスコア、与信限度額、残高、支払い履歴、連絡先情報を含む顧客ステータス情報
  - 社会保障番号 アメリカ 約14万人 カナダ 約100万人
  - 銀行口座番号 アメリカ 約8万件
- インシデントタイムライン

| 日時 | 出来事 |
|:--|:--|
| 2019年3月22日、23日 | Capital OneのAWS環境へ不正アクセスが発生。 |
| 2019年6月27日 | 女が自分のSlackチャンネルへ違法取得したDBとみられるリストを投稿 |
| 2019年7月17日 | Capital Oneへデータリークに関する情報提供 |
| 2019年7月19日 | Capital Oneが流出の事実を確認 |
| 2019年7月29日 | FBIが不正アクセス事件関与の女を逮捕 |
| 同日 | 米司法省が女の逮捕を発表 |
| 2019年7月30日 | Capital Oneがインシデントを公表 |

- 発端はCapital OneのResponsible Disclosure Programへの報告
  - 同社のS3 Bucketの情報がGithub上で公開されているとの指摘
- 原因はWAF設定ミス
  - Apache Modsecurityを採用
    - AWS WAFではなく、Capital Oneが独自構築
  - 不正アクセス者は設定ミスを悪用し、WAFを介してAWS EC2のインスタンスメタデータへ接続
  - ModsecurityにはSSRF攻撃を検出するルールセットは既定（CRS）には含まれていない
  - AWSのインスタンスメタデータは接続に際して認証は行われない
- AWSの軽減策

| サービス | 概要 |
|:--|:--|
| AWS IAM Access Advisor | 必要以上の権限を持つロールを特定することが可能 |
| Amazon GuardDuty | 脅威となりえる潜在的スキャンや大量のデータ移動を検出、通知する機能 |
| AWS WAF | 今回問題となったSSRF攻撃も検出可能 |
| Amazon Macie | 機械学習による機密情報の分類、検出、および保護が可能 |

- 事件関与の人物
  - 逮捕、起訴されたのはワシントン州シアトル在住 ソフトウェアエンジニア 女 33歳
  - Amazon.comは摘発された人物が過去クラウド部門従業員であったことを確認
  - 流出したデータがAWSのS3に格納されていたとみられることからインサイダーの犯行と当初噂されていたことがあった
- 事件捜査の状況
  - 女はComputer Fraud and Abuse（コンピュータに関する詐欺、濫用）の容疑で起訴

### 感想
- こういったセキュリティについての事件を見ると、専門家までいかずともセキュリティに対して知識を持つ重要性を改めて感じる
- セキュリティに対する
